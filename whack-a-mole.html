<!doctype html>
<html lang="zh-Hant">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    <title>打地鼠</title>
    <style>
        body {
            background-color: #AACB90;
        }

        .header {
            background-color: rgba(100, 100, 100, .5);
            margin-bottom: 10px;
        }

        .row .col-3,
        .col-4 {
            background-color: #ccc;
            margin: 10px auto;
            height: 50px;
            border-radius: 10px;
        }

        .row .col-3 h3,
        .row .col-4 h3 {
            font-size: 15px;
            margin-bottom: 0;
        }

        .row .col-3 p {
            font-size: 30px;
            color: red;
            margin-bottom: 0;
        }

        .circle {
            background-color: #6B4444;
            width: 100%;
            height: 30px;
            border-radius: 50%;
            position: absolute;
            bottom: 0;
        }

        .initial {
            position: absolute;
            z-index: 2;
            width: 120px;
            bottom: 0;
            right: 0;
            left: 0;
            top: 200px;
            margin: auto;
            transition: top .2s ease-in-out;
        }

        .active {
            top: 0;
        }

        .hole-row {
            margin-bottom: 30px;
        }

        .hole {
            width: 130px;
            height: 127px;
            overflow: hidden;
            position: relative;
            padding: 0;
        }
    </style>
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-W9DRT5H');</script>
    <!-- End Google Tag Manager -->
</head>

<body>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-W9DRT5H"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->

    <!-- <div class="startNmber">
            <p>3</p>
        </div> -->
    <header class="header">
        <div class="container">
            <div class="row d-flex justify-content-evenly">
                <div class="col-4 d-flex justify-content-evenly align-items-center">
                    <h3>難易度</h3>
                    <div class="group">
                        <button btn-id="3" class="levelBtn btn btn-info">初級</button>
                        <button btn-id="2" class="levelBtn btn btn-warning">普通</button>
                        <button btn-id="1" class="levelBtn btn btn-danger">困難</button>
                    </div>
                </div>
                <div class="col-3 d-flex align-items-center text-center">
                    <div class="title w-25">
                        <h3>得分</h3>
                    </div>
                    <div class="txt w-75">
                        <p class="score">{{score}}</p>
                    </div>
                </div>
                <div class="col-3 d-flex align-items-center text-center">
                    <div class="title w-25">
                        <h3>剩餘時間</h3>
                    </div>
                    <div class="txt w-75">
                        <p class="time">{{time}}</p>
                    </div>
                </div>
            </div>
        </div>
    </header>
    <div class="life text-end">
        <span>life: </span>
        <span class="lifeTxt"></span>
    </div>
    <main class="container">
        <div class="col-9 mx-auto">
            <div class="row hole-row d-flex justify-content-evenly">
                <div class="hole">
                    <img target-id="1" class="initial" src="img/img_whack-a-mole/target_new.png" alt="">
                    <div class="circle">
                    </div>
                </div>
                <div class="hole">
                    <img target-id="2" class="initial" src="img/img_whack-a-mole/target_new.png" alt="">
                    <div class="circle">
                    </div>
                </div>
                <div class="hole">
                    <img target-id="3" class="initial" src="img/img_whack-a-mole/target_new.png" alt="">
                    <div class="circle">
                    </div>
                </div>
            </div>
            <div class="row hole-row d-flex justify-content-evenly">
                <div class="hole">
                    <img target-id="4" class="initial" src="img/img_whack-a-mole/target_new.png" alt="">
                    <div class="circle">
                    </div>
                </div>
                <div class="hole">
                    <img target-id="5" class="initial" src="img/img_whack-a-mole/target_new.png" alt="">
                    <div class="circle">
                    </div>
                </div>
                <div class="hole">
                    <img target-id="6" class="initial" src="img/img_whack-a-mole/target_new.png" alt="">
                    <div class="circle">
                    </div>
                </div>
            </div>
            <div class="row hole-row d-flex justify-content-evenly">
                <div class="hole">
                    <img target-id="7" class="initial" src="img/img_whack-a-mole/target_new.png" alt="">
                    <div class="circle">
                    </div>
                </div>
                <div class="hole">
                    <img target-id="8" class="initial" src="img/img_whack-a-mole/target_new.png" alt="">
                    <div class="circle">
                    </div>
                </div>
                <div class="hole">
                    <img target-id="9" class="initial" src="img/img_whack-a-mole/target_new.png" alt="">
                    <div class="circle">
                    </div>
                </div>
            </div>

        </div>
    </main>

    <!-- modal -->
    <div class="modal fade" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title text-center">{{title}}</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p class="modal-txt">{{text}}</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">確定</button>
                </div>
            </div>
        </div>
    </div>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
        crossorigin="anonymous"></script>

    <script>
        let score, time, life, targetIntervalId, timeoutId, timeInterval, firstNumber, secondNumber
        let timeArr = []

        //DOM
        let targets = document.querySelectorAll('.hole img')
        let scoreTxt = document.querySelector('.score')
        let timeTxt = document.querySelector('.time')
        let lifeTxt = document.querySelector('.lifeTxt')
        let levelBtns = document.querySelectorAll('.levelBtn')
        let modalTitle = document.querySelector('.modal-title')
        let modalBody = document.querySelector('.modal-txt')
        let modal = document.querySelector('.modal')


        window.onload = function () {
            set()
            init()
        }

        function set() {
            targets.forEach(target => {
                target.onclick = function () {
                    target.classList.remove('active')
                    clearTimeout(timeoutId)
                    score += 5
                    scoreTxt.innerText = score
                }
            })

            levelBtns.forEach(btn => {
                btn.addEventListener('click', startGame.bind(event, btn))
            })
        }

        function init() {
            clearInterval(targetIntervalId)
            timeArr.forEach(x => {
                clearTimeout(x)
            })
            clearInterval(timeInterval)
            timeArr = []
            score = 0
            life = 3
            time = 0
            timeTxt.innerText = `${time} 秒`
            scoreTxt.innerText = score
            lifeTxt.innerText = life

            targets.forEach(target => {
                target.classList.remove('active')
            })

            levelBtns.forEach(btn => {
                btn.removeAttribute('disabled')
            })
        }

        function startGame(btn) {
            let level = parseInt(btn.getAttributeNode('btn-id').value)
            console.log(level)

            // time = level * 40
            time = 60
            if (time > 0) {
                console.log('startgame')
                timeInterval = setInterval(countDown, 1000)
                
            }

            levelBtns.forEach(btn => {
                btn.setAttribute('disabled', '')
            })

            // 長出地鼠
            if (life > 0) {
                targetIntervalId = setInterval(addOne.bind(event, level), level * 400)
            }
            //life圖示
            //開始倒數3秒

        }

        function countDown() {
            time--
            timeTxt.innerText = `${time} 秒`
            if (time == 0) {
                modalTitle.innerText = '時間到!'
                modalBody.innerHTML = `得分: ${score}<br>請重新開始遊戲`
                bootstrap.Modal.getOrCreateInstance(modal).show()
                init()
            }
        }

        function addOne(level) {
            let random = getRandom()
            console.log(`random: ${random}`)
            targets[random].classList.add('active')
            //沒被打到的地鼠自動收回
            if (targets[random].classList.contains('active')) {
                timeoutId = setTimeout(removeOne.bind(event, random), level * 1200)
                timeArr.push(timeoutId)
            }
        }

        function removeOne(random) {
            targets[random].classList.remove('active')
            life--
            lifeTxt.innerText = life
            console.log(life)

            //生命耗盡
            if (life <= 0) {
                modalTitle.innerText = '遊戲結束!'
                modalBody.innerHTML = `得分: ${score}<br>你輸給了地鼠! 請重新開始遊戲`
                bootstrap.Modal.getOrCreateInstance(modal).show()
                init()
            }
        }

        function getRandom() {
            firstNumber = Math.floor(Math.random() * targets.length)
            if (firstNumber == secondNumber) {
                firstNumber = Math.floor(Math.random() * targets.length)
            }
            secondNumber = firstNumber
            return firstNumber
        }
    </script>


</body>

</html>